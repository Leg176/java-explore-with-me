# Explore with me

Java, Spring (Boot, Data), PostgreSQL, REST API, Docker, Mockito, JUnit, Postman, Lombok, MapStruck

## О проекте

Приложение для размещения событий их модерации, поиска, а также регистрации для участия в них

<p align="center">
  <img src="https://pictures.s3.yandex.net/resources/S19_09-2_1674558748.png" />
</p>

Приложение содержит два микросервиса:

- main-service для бизнес-логики
- stat-service для сбора статистики

Каждый микросервис имеет свою база данных.

## Основная функциональность:

### Неавторизованные пользователи

- просмотр событий согласно поставленным фильтрам
- просмотр отдельных событий по ID события
- вывод подборки событий согласно установленным фильтрам
- вывод подборки событий по ID подборки
- просмотр всех категорий событий
- вывод категории по ID категории 

### Авторизованные пользователи

- создание события
- редактирование события
- вывод событий пользователя - организатора
- вывод конкретного события организатором которого является пользователь
- вывод пользователем всех своих заявок на участие в событиях
- подтвердить или отклонить заявку на участие в своём событии
- подача заявки на участие в событии
- отмена заявок на участие в своём событии
- получить список заявок на участие в своём событии

### Администраторы

- создание категорий
- редактирование категорий
- удаление категорий
- создание подборок событий
- редактирование подборок событий
- удаление подборок событий
- создание пользователей
- удаление пользователей
- вывод пользователей согласно переданному списку ID пользователей
- добавление события
- вывод списка событий согласно переданным параметрам
- изменение события по ID и списку переданных параметров

## Эндпоинты

### main-service

### 1. События (Events)
####   Для всех пользователей:

- GET /events — список событий с фильтрами (text, categories, paid, rangeStart, rangeEnd, onlyAvailable, sort, from, size);
    - text - текст для поиска в названии и описании событий
    - categories - список id категорий событий
    - paid - только платные события (true/false)
    - rangeStart - начало временного отрезка в формате yyyy-MM-dd HH:mm:ss
    - rangeEnd - конец временного отрезка в формате yyyy-MM-dd HH:mm:ss
    - onlyAvailable - только доступные события, т.е. у которых еще не исчерпан лимит участников (true/false)
    - sort - способ сортировки событий (EVENT_DATE, VIEWS)
    - from - параметр для пагинации
    - size - параметр для пагинации

- GET /events/{eventId} — событие по ID;

####   Для авторизованных пользователей/организаторов:

- POST /users/{userId}/events — создать событие;

- PATCH /users/{userId}/events/{eventId} — редактировать событие;

- GET /users/{userId}/events — мои события (как организатор);

- GET /users/{userId}/events/{eventId} — моё событие по ID;

- GET /users/{userId}/events/{eventId}/requests — заявки на участие в моём событии;

- PATCH /users/{userId}/events/{eventId}/requests — подтвердить/отклонить заявку (тело запроса: { "status": "APPROVED" | "REJECTED" }).

- POST /users/{userId}/requests — подать заявку на участие;

- PATCH /users/{userId}/requests/{requestId}/cancel — отменить свою заявку;
  
- GET /users/{userId}/requests — мои заявки на участие в событиях;

####   Для администраторов:

- PATCH /admin/events/{eventId} — редактировать любое событие;

- GET /admin/events — поиск событий по параметрам (users, states, categories, rangeStart, rangeEnd, from, size).
    - users - список id пользователей
    - states - список статусов события (PENDING, PUBLISHED, CANCELED)
    - categories - список id категорий событий
    - rangeStart - начало временного отрезка в формате yyyy-MM-dd HH:mm:ss
    - rangeEnd - конец временного отрезка в формате yyyy-MM-dd HH:mm:ss
    - from - параметр для пагинации
    - size - параметр для пагинации

### 2. Категории (Categories)
####   Для всех пользователей:

- GET /categories — все категории;

- GET /categories/{catId} — категория по ID;

####   Для администраторов:

- POST /admin/categories — создать категорию;

- PATCH /admin/categories/{catId} — редактировать категорию;

- DELETE /admin/categories/{catId} — удалить категорию.

### 3. Подборки (Compilations)
####   Для всех пользователей:

- GET /compilations — все подборки событий;

- GET /compilations/{compId} — подборка по ID.

####   Для администраторов:

- POST /admin/compilations — создать подборку;

- PATCH /admin/compilations/{compId} — редактировать подборку;

- DELETE /admin/compilations{compId} — удалить подборку.

### 4. Пользователи (Users)
####   Для администраторов:

- POST /admin/users — создать пользователя;

- DELETE /admin/users/{userId} — удалить пользователя;

- GET /admin/users — поиск пользователей по ID (параметр ids).

### stats-service

- GET /stats - Получение статистики по посещениям
- POST /hit - Сохранение информации о том, что на uri конкретного сервиса был отправлен запрос пользователем

#### В качестве фичи в проект внедрена возможность добавления комментариев.

##   Комментарии

### Ключевые особенности
- Три типа пользователей

#### Авторизованные:
-   комментируют без ввода email/имени
-   комментарии сразу публикуются без модерации
-   могут изменять свои комментарии
-   могут выводить все комментарии на свои события или же все свои комментарии во всех событиях
-   могут изменять статус своих комментариев на отменённые(CANCELED)

Гости — указывают имя и email при отправке комментария.

Модерация состояний

Комментарии сохраняются со статусом PENDING (на проверке).

После модерации статус меняется на APPROVED/REJECTED.

Валидация данных

Обязательные поля: текст комментария (20–7000 символов).

Для гостей: имя (2–250 символов), email (корректный формат).

Защита от спама

Лимит: не более 5 комментариев от одного email за 15 минут.

Проверка на дубликаты (по email + eventId + текст).

Связи с сущностями

Каждый комментарий привязан к событию (eventId).

Для авторизованных: связь с пользователем (userId).
